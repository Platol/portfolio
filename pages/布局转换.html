<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="../img/ico.ico">
    <link rel="stylesheet" href="../css/reset.css">
    <script src="../js/common.js"></script>
    <title>布局转换</title>
    <style>
        ul {
            width: 366px;
            margin: 50px auto;
            border: 10px dashed #eee;
            padding: 10px;
            position: relative;
        }

        ul:after {
            content: "";
            display: block;
            clear: both;
        }

        li {
            width: 100px;
            height: 100px;
            background: #faf;
            float: left;
            margin: 10px;
            text-align: center;
            line-height: 100px;
            border: 1px solid red;
        }
    </style>
</head>

<body>
    <ul>
        <li>1</li>
        <li>2</li>
        <li>3</li>
        <li>4</li>
        <li>5</li>
        <li>6</li>
        <li>7</li>
        <li>8</li>
        <li>9</li>
    </ul>

    <script>
        var oUl = document.getElementsByTagName('ul')[0];
        var aLi = oUl.getElementsByTagName('li');
        var nimZindex = 2;

        for (var i = 0; i < aLi.length; i++) {
            setStyle(aLi[i], { 'left': aLi[i].offsetLeft + 'px', 'top': aLi[i].offsetTop + 'px' });
        }

        setStyle(oUl, { 'width': oUl.clientWidth + 'px', 'height': oUl.clientHeight + 'px' });

        for (var i = 0; i < aLi.length; i++) {
            setStyle(aLi[i], { 'position': 'absolute', 'margin': 0, 'float': null });
        }

        setStyle(oUl, { 'padding': 0 });

        for (var i = 0; i < aLi.length; i++) {
            aLi[i].onmouseover = function () {
                this.style.zIndex = nimZindex++;
                //animate( this, { 'width':200, 'height':200, 'marginLeft':-50, 'marginTop':-50 } );
                doMove(this, { 'width': 200, 'height': 200, 'marginLeft': -50, 'marginTop': -50 }, 5);
            }
            aLi[i].onmouseout = function () {
                this.style.zIndex = nimZindex++;
                //animate( this, { 'width':100, 'height':100, 'marginLeft':0, 'marginTop':0 } );
                doMove(this, { 'width': 100, 'height': 100, 'marginLeft': 0, 'marginTop': 0 }, 5);
            }
        }


        function doMove(obj, json, n, endFn) {
            clearInterval(obj.timer);
            var iValue = 0;
            var iSpeed = 0;
            var iOffset = 0;
            obj.timer = setInterval(function () {
                var isStop = true;
                for (var attr in json) {
                    var iTarget = json[attr];

                    if (attr == 'opacity') {
                        iValue = parseInt(parseFloat(getStyle(obj, attr)) * 100);
                    } else {
                        iValue = parseInt(getStyle(obj, attr));
                    }

                    iSpeed = (iTarget - iValue) / n;
                    iSpeed = iSpeed > 0 ? Math.ceil(iSpeed) : Math.floor(iSpeed);
                    iOffset = iValue + iSpeed;

                    if (iValue != iTarget) {
                        isStop = false;
                        if (attr == 'opacity') {
                            obj.style.opacity = iOffset / 100;
                            obj.style.filter = 'alpha(opacity=' + iOffset + ')';
                        } else {
                            obj.style[attr] = iOffset + 'px';
                        }
                    }
                }
                if (isStop) {
                    clearInterval(obj.timer);
                    endFn && endFn();
                }
            }, 30);
        }

    </script>
</body>

</html>